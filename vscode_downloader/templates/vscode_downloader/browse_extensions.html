<!DOCTYPE html>
<html>
<head>
    <title>VSCode Extensions Browser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            height: 100vh;
            overflow: hidden;
        }
        .master-view {
            background-color: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 20px;
        }
        .detail-view {
            overflow-y: auto;
            padding: 20px;
        }
        .search-form {
            position: sticky;
            top: 0;
            background-color: white;
            padding: 20px;
            border-bottom: 1px solid #ddd;
            z-index: 100;
        }
        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .extension-card {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .extension-card:hover {
            background-color: #f5f5f5;
        }
        .extension-card.selected {
            background-color: #e3f2fd;
        }
        .extension-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .extension-publisher {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .extension-description {
            font-size: 0.9em;
            color: #444;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .pagination-controls input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .search-button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            background-color: #007acc;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .search-button:hover {
            background-color: #005999;
        }
    </style>
</head>
<body>
    <div class="layout">
        <div class="master-view">
            <div class="search-form">
                <form method="get">
                    <input type="text" name="search" class="search-input" 
                           value="{{ search_query }}" placeholder="Search extensions...">
                    <input type="number" name="page_size" value="{{ page_size }}" 
                           min="1" max="100" style="width: 70px;">
                    <input type="number" name="max_page" value="{{ max_page }}" 
                           min="1" max="10" style="width: 70px;">
                    <button type="submit">Search</button>
                </form>
            </div>

            <div id="extensions-list">
                {% for extension in extensions %}
                <div class="extension-card" 
                     data-extension-id="{{ extension.publisher }}.{{ extension.extensionName }}"
                     onclick="loadExtensionDetails(this)">
                    <div class="extension-name">{{ extension.displayName }}</div>
                    <div class="extension-publisher">{{ extension.publisher }}.{{ extension.extensionName }}</div>
                    <div class="extension-description">{{ extension.shortDescription }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="detail-view" id="detail-view">
            <div class="loading" style="display: none;">Loading extension details...</div>
            <div id="extension-details"></div>
        </div>
    </div>

    <script>
        function loadExtensionDetails(element) {
            // Remove selected class from all cards
            document.querySelectorAll('.extension-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            element.classList.add('selected');
            
            const extensionId = element.dataset.extensionId;
            const detailView = document.getElementById('extension-details');
            const loading = document.querySelector('.loading');
            
            // Show loading state
            loading.style.display = 'block';
            detailView.innerHTML = '';
            
            // Fetch extension details
            fetch(`/vscode_downloader/api/extensions/${extensionId}/`)
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    detailView.innerHTML = renderExtensionDetails(data);
                })
                .catch(error => {
                    loading.style.display = 'none';
                    detailView.innerHTML = `<div class="error">Error loading extension details: ${error}</div>`;
                });
        }

        function renderExtensionDetails(extension) {
            // Create HTML for extension details (similar to extension_details.html template)
            return `
                <div class="container">
                    <div class="header">
                        ${extension.versions[0].files
                            .filter(file => file.assetType === "Microsoft.VisualStudio.Services.Icons.Default")
                            .map(file => `<img src="${file.source}" alt="Extension icon" class="icon">`)
                            .join('')}
                        <div class="title-section">
                            <h1 class="extension-name">${extension.displayName}</h1>
                            <div class="publisher">
                                By ${extension.publisher.displayName}
                                (${extension.publisher.publisherName}.${extension.extensionName})
                            </div>
                            <div class="stats">
                                <div class="stat-item">
                                    <span>Version:</span>
                                    <strong>${extension.versions[0].version}</strong>
                                </div>
                                ${extension.statistics
                                    .filter(stat => stat.statisticName === "install")
                                    .map(stat => `
                                        <div class="stat-item">
                                            <span>Downloads:</span>
                                            <strong>${stat.value}</strong>
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                    </div>

                    ${extension.version_info ? `
                        <div class="version-info">
                            <div class="section-title">Version Compatibility</div>
                            <table class="version-table">
                                <thead>
                                    <tr>
                                        <th>Extension Version</th>
                                        <th>Minimum VSCode Version</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${extension.version_info.map(version => `
                                        <tr>
                                            <td>${version.version}</td>
                                            <td>${version.min_vscode}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : ''}

                    <div class="section">
                        <div class="description">${extension.shortDescription}</div>
                        ${extension.versions[0].files
                            .filter(file => file.assetType === "Microsoft.VisualStudio.Services.Content.Details")
                            .map(file => `<div class="full-description">${file.source}</div>`)
                            .join('')}
                    </div>

                    ${extension.categories ? `
                        <div class="section">
                            <div class="section-title">Categories</div>
                            <div class="tag-list">
                                ${extension.categories.map(category => 
                                    `<span class="tag">${category}</span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${extension.tags ? `
                        <div class="section">
                            <div class="section-title">Tags</div>
                            <div class="tag-list">
                                ${extension.tags.map(tag => 
                                    `<span class="tag">${tag}</span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }
    </script>
</body>
</html> 